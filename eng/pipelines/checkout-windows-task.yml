# Shallow checkout sources on Windows
steps:
  - checkout: none

  - pwsh: |
      $gitCommands = Get-Command git -ErrorAction SilentlyContinue
      if (-not $gitCommands) {
        winget install --id Git.Git -e --source --silent winget
        $gitCommands = Get-Command git -ErrorAction SilentlyContinue
        if (-not $gitCommands) {
          throw "Unable to find a git executable"
        }
      }

      git init
      git remote add origin "$(Build.Repository.Uri)"
      git fetch --progress --no-tags --depth=1 origin "$(Build.SourceVersion)"
      git checkout "$(Build.SourceVersion)"
    displayName: Shallow Checkout
